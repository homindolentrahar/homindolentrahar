---
import Layout from "@/layouts/Layout.astro";
import type { GetStaticPaths } from "astro";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";
import { getCollection } from "astro:content";
import { levelColors } from "@/constant/leet_difficulty_level";
import { cn } from "@/lib/utils";
import Prose from "@/components/Prose.astro";
import moment from "moment";

export const getStaticPaths = (async () => {
  const posts: CollectionEntry<"leet">[] = await getCollection("leet");

  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}) satisfies GetStaticPaths;

const { slug } = Astro.params;
const entry = await getEntry("leet", slug);
const { Content } = await entry.render();
---

<Layout title={`Leet - ${entry?.data.title}`}>
  <main class="flex flex-col">
    <div class="flex flex-col items-center min-h-[720px] px-8 py-16 mt-16">
      <div class="w-full md:w-10/12 flex flex-col items-center">
        <span
          class={cn(
            "px-4 py-1 rounded-lg font-semibold",
            levelColors.find(
              (e) => e.difficulty === entry.data.difficulty.title
            )?.color ?? "text-gray-600",
            levelColors.find(
              (e) => e.difficulty === entry.data.difficulty.title
            )?.bgColor ?? "bg-gray-600/15"
          )}>{entry?.data.difficulty.title}</span
        >
        <h1
          class="text-3xl lg:text-4xl font-semibold text-gray-950 dark:text-white text-center mt-4"
        >
          {entry?.data.title}
        </h1>
        <p
          class="font-normal text-gray-500 dark:text-gray-400 text-sm md:text-base mt-4"
        >
          Updated at:
          <span class="font-medium text-gray-950 dark:text-white"
            >{
              moment(entry?.data.updatedAt).format("dddd, DD MMMM yyyy | HH:mm")
            }</span
          >
        </p>
        <div class="flex flex-row items-center gap-2 mt-4">
          {
            entry?.data.tags.map((word: string) => (
              <span class="px-3 py-1 rounded-full bg-gray-950 dark:bg-white text-white dark:text-gray-950 text-sm font-medium transition-all">
                #{word}
              </span>
            ))
          }
        </div>
        <Prose className="mt-16 w-full">
          <Content />
        </Prose>
      </div>
    </div>
  </main>
</Layout>
